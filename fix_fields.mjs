import fs from "fs"; import path from "path"; import { fileURLToPath } from "url"; const __filename = fileURLToPath(import.meta.url); const __dirname = path.dirname(__filename); const programsDir = path.join(process.cwd(), "public/content/programs"); const files = fs.readdirSync(programsDir).filter(f => f.match(/^program\d+\.json$/)); files.forEach(file => { const filePath = path.join(programsDir, file); console.log(`处理文件: ${file}`); try { const content = fs.readFileSync(filePath, "utf8"); const program = JSON.parse(content); let modified = false; if (program.grade_level_en && typeof program.grade_level_en === "string") { if (program.grade_level_en.includes(",") || program.grade_level_en.includes(";")) { const values = program.grade_level_en.split(/[,;]/).map(v => v.trim()).filter(v => v); program.grade_level_en = values; } else { program.grade_level_en = [program.grade_level_en]; } modified = true; console.log(`  修改了 ${file} 中的 grade_level_en`); } if (program.grade_level_zh && typeof program.grade_level_zh === "string") { if (program.grade_level_zh.includes(",") || program.grade_level_zh.includes(";")) { const values = program.grade_level_zh.split(/[,;]/).map(v => v.trim()).filter(v => v); program.grade_level_zh = values; } else { program.grade_level_zh = [program.grade_level_zh]; } modified = true; console.log(`  修改了 ${file} 中的 grade_level_zh`); } if (program.country_en && typeof program.country_en === "string") { program.country_en = [program.country_en]; modified = true; console.log(`  修改了 ${file} 中的 country_en`); } if (program.country_zh && typeof program.country_zh === "string") { program.country_zh = [program.country_zh]; modified = true; console.log(`  修改了 ${file} 中的 country_zh`); } if (modified) { fs.writeFileSync(filePath, JSON.stringify(program, null, 2), "utf8"); console.log(`  已更新 ${file}`); } else { console.log(`  ${file} 无需修改`); } } catch (err) { console.error(`处理 ${file} 时出错: ${err.message}`); } }); console.log("所有文件处理完成");
